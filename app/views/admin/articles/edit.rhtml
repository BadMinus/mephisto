<%= render :partial => "page_nav" %>

<% content_for :sidebar do %>
  <div class="sgroup">
    <h3>Revisions<% if params[:version] -%> (<%= link_to 'current', :action => :edit, :id => @article, :version => nil %>)<% end -%></h3>
    <ul id="revisions">
    <% @article.versions.find(:all, :order => 'updated_at DESC', :limit => 4).each do |version| -%>
      <li>
        <%= link_to avatar_for(version.updater), {:action => 'edit', :id => @article, :version => version.version }, :title => 'Edit this revision' %>
        <h4><%=h who(version.updater.login) %></h4>
        edited this <%= time_ago_in_words version.updated_at %> ago.
        <span class="rev-num"><%= version.version %></span>
      </li>
    <% end -%>
    </ul>
  </div>
  
  <div class="sgroup">
    <% fields_for :article, @version do |f| -%>
    <dl class="setform clear">
      <dt><label for="article_filters">What markup type do you prefer?</label></dt>
      <dd>
        <select name="article[filters][]" id="article_filters">
          <%= options_for_select(filter_options, (@version.filters || []).first.to_s) %>
        </select>
      </dd>
      <dt><label><%= f.check_box :parse_macros %> Parse body with the Macro Filter?</label></dt>
    </dl>
    <% end -%>
  </div>
<% end %>

<%= error_messages_for :article %>

<% content_for :form do -%>
  <%= start_form_tag({:action => 'update', :id => @article}, {:id => 'article-form'}) %>
<% end -%>

<% fields_for :article, @version do |f| -%>
<%= render :partial => 'form', :object => f %>
<p class="btns">
  <%= submit_tag 'Apply Changes' %>
  <%= submit_tag 'Save without Revision' %>
  <%= link_to "cancel", :controller => "articles" %></p>
<% end -%>


